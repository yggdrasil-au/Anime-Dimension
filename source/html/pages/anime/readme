# Anime Pages Architecture

This directory contains different architectural approaches for rendering the Anime "All" (Search/Listing) page and the "Slug" (Detail) page. Each version serves a specific purpose regarding performance, data freshness, and offline capability. The **static/offline** pages in the root of this directory are the **primary production** implementation; the non-static variants have been moved under `dev/` and are kept as development tools and reference implementations.

## Quick Comparison

| Type | Directory | Rendering Strategy | Data Source | offline Capable |
|------|-----------|--------------------|-------------|-----------------|
| **Static (Primary)** | Root (`./`) | **SG** (Static Generation) | Build-time Embedded JSON / SQLite | **Yes** (Fully) |
| **SSG (Dev / Ref)** | `dev/ssg-csr/` | **Shell** (Static) + **Content** (Client) | Runtime API / Fetch | Shell only |
| **CSR (Dev / Ref)** | `dev/csr/` | **CSR** (Client Side Rendering) | Runtime API / Fetch | No |

---

## 1. Static / Offline (Default)

These pages are fully pre-rendered at build time. They are designed for maximum performance and complete offline availability (PWA).

**Benefits**:
- **Instant Loading**: Zero-latency rendering since the content is already in the HTML.
- **Perfect SEO**: Search engines see the full content immediately without needing to execute JavaScript.
- **100% Offline**: Works perfectly without an internet connection once the PWA is cached.

**Trade-offs / Cons**:
- **Larger initial HTML payload**: The `all.static` page embeds a light copy of the anime database directly into the HTML, which increases the initial download size and memory usage, especially on low-end or mobile devices.
- **Heavier rebuilds for data changes**: Any change to the dataset requires a full rebuild and re-deploy of the static pages, since all content is baked in at build time.
 - **Longer builds and bigger output**: The `[slug].astro` page generates a physical HTML file for every anime. As the catalog grows, build time and output size scale linearly, which increases CI/CD duration and deploy artifact size.
 - **Potentially stale metadata**: Things like ratings or episode counts are fixed at build time. Users do not see updated values until a new build is run and deployed.

### All Page: `all.static.astro`
- **Purpose**: Provides a searchable list of all anime.
- **Mechanism**:
  - The entire dataset of anime (lite version) is embedded directly into the HTML as a JSON script (`#offline-data`).
  - Search and filtering are performed entirely client-side using this embedded data.
  - No network requests are made for search results.

### Slug Page: `[slug].astro`
- **Purpose**: Detailed view for a specific anime.
- **Mechanism**:
  - Astro generates a physical HTML file for **every** anime in the database during the build.
  - All metadata (synopsis, characters, staff, etc.) is baked into the HTML.
  - No API calls are required to view the content.

---

## 2. SSG / Hybrid (API Driven)

These pages use the "App Shell" model. The layout (header, footer, navigation) is pre-rendered, but the main content is fetched dynamically by the client. This allows for fresher data without rebuilding the entire site. The SSG+CSR variants now live under `admin/ssg-csr/` and are intended primarily as development and reference implementations, not the main production entry point.

**Benefits**:
- **Fresh Content**: Fetches the latest data from the API on every page load, ensuring information like current ratings or episode counts are always accurate.
- **Clean URLs**: By using `getStaticPaths` to pre-render the "Shell" for every show, we get clean, human-readable paths (e.g., `/anime/ssg-csr/naruto`) instead of query strings.
- **Faster Builds**: For massive databases, pre-rendering just the shells is significantly faster than baking every detail into thousands of static files.

**Trade-offs / Cons**:
- **Network and JS required for content**: The shell HTML is static, but both the All and Slug pages rely on client-side JavaScript and API calls to render the actual data. With JavaScript disabled or during API outages, users see an empty or incomplete page.
- **First-content latency vs static**: Unlike the fully static pages, the first meaningful content depends on at least one API round trip, which increases time-to-data compared to the offline variant.
- **Slug / data sync complexity**: `getStaticPaths` for `ssg-csr/[slug].astro` is driven by the central SQLite/JSON data. If the API or upstream data diverge from that source, you can end up with pre-rendered shells whose client fetches fail or show mismatched information.

### All Page: `admin/ssg-csr/all.ssg.astro`
- **Purpose**: API-driven search page.
- **Mechanism**:
  - The page shell is static.
  - Unlike the static version, it does **not** contain embedded data.
  - On load, it fetches the anime list from a public API endpoint.
  - Uses the same visual components as the static version.

### Slug Page: `admin/ssg-csr/[slug].astro`
- **Purpose**: API-driven detail page.
- **Mechanism**:
  - The page shell is static.
  - Defines `getStaticPaths` to generating routes (shells) for known slugs.
  - Actual content is hydrated client-side by fetching data (e.g., JSON) based on the current slug.
  - **Advantage**: It removes the need for `?name=` or `?id=` arguments by mapping the show name directly to a physical file path (the pre-rendered shell).

---

## 3. CSR (Client Side Rendering)

The CSR variant is intended primarily for development testing and debugging of client-side logic without the overhead of static path generation. It now lives under `admin/csr/` and is not used as a primary production route.

**Benefits**:
- **Developer Experience**: No build-time overhead for generating paths; changes to the JS logic can be tested instantly.
- **Simplicity**: One single file handles all possible shows genericly.

**Trade-offs / Cons**:
- **Poor SEO and no SSR**: All meaningful content for `csr/detail.csr.astro` is rendered entirely on the client. Search engines and users without JavaScript only see the bare shell.
- **No offline guarantees**: Unlike the static variant, this mode depends on live API calls at runtime. Without a network connection, the page cannot load anime details.
- **Query-parameter routing only**: It relies on `?name=` query parameters instead of clean path-based routes. This makes links less user-friendly and slightly more fragile for deep-linking.
- **Not intended for production**: This path is optimized for experimentation and debugging; it duplicates logic that already exists in the SSG+CSR flow and is not meant to be the primary user-facing experience.

### Slug Page: `admin/csr/detail.csr.astro`
- **Purpose**: Pure client-rendered detail view.
- **Mechanism**:
  - Single static HTML entry point.
  - Does NOT use path-based routing (e.g., `/anime/naruto`).
  - Uses query parameters (e.g., `?name=Naruto`) to determine which content to load.
  - Useful for testing the rendering JS logic in isolation.
